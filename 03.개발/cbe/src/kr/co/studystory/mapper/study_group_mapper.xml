<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <!--쿼리문을 정의  
  	namespace : XML내에서 중복된 id를 사용할 수 있도록 구분하는 것.
  					(패키지와 비슷한 용도)
  -->
<mapper namespace="kr.co.studystory">
	<resultMap type="kr.co.studystory.domain.PrevStudyInfo" id="studyResult">
		<result column="study_name" property="name"/>
		<result column="loc" property="loc"/>
		<result column="category" property="category"/>
		<result column="content" property="content"/>
		<result column="img" property="img"/>
	</resultMap>
	
	<!-- sNum, studyName, loc, category, img, recruitment, inputdate, nick, deacivation; -->
	<resultMap type="kr.co.studystory.domain.MyStudy" id="myStudyResult">
		<result column="s_num" property="sNum"/>
		<result column="study_name" property="studyName"/>
		<result column="loc" property="loc"/>
		<result column="category" property="category"/>
		<result column="img" property="img"/>
		<result column="recruitment" property="recruitment"/>
		<result column="input_date" property="inputdate"/>
		<result column="nick" property="nick"/>
		<result column="deactivation" property="deactivation"/>
	</resultMap>
	
	<resultMap type="kr.co.studystory.domain.AppliedStudy" id="appliedStudyResult">
		<result column="s_num" property="sNum"/>
		<result column="study_name" property="studyName"/>
		<result column="loc" property="loc"/>
		<result column="category" property="category"/>
		<result column="img" property="img"/>
		<result column="recruitment" property="recruitment"/>
		<result column="input_date" property="inputDate"/>
		<result column="nick" property="nick"/>
		<result column="accept_flag" property="joinAcceptFlag"/>
	</resultMap>
	
<select id="selectDupStudyName" parameterType="String" resultType="int">
	select count(*) cnt
	from study
	where s_num=#{s_num}
</select>	
	
	
  <insert id="insertStudy" parameterType="kr.co.studystory.vo.NewStudyVO">
  insert into study(img,recruitment,accept_flag,input_date,deactivation,id,delete_flag,s_num,study_name,loc,category,content) 
  values(#{img},'Y' ,'N' ,sysdate ,'N' ,#{id},'N' ,s_num.nextval,#{studyName},#{loc},#{category},#{content})
  </insert>
  
  
  <select id="selectPrevStudyInfo" resultMap="studyResult" >
 	select study_name, loc, category, content, img
	from study
	where id=#{id}
  </select>
  
<update id="updateStudy" parameterType="kr.co.studystory.vo.ModifiedStudyVO">
  update study
  set 		content=#{content}, img=#{img}
  where s_num=#{sNum}
  </update>
  
  <select id="selectMyStudies" resultMap="myStudyResult" parameterType="String">
	select s.s_num, study_name, loc, category, s.img, recruitment, input_date, s.deactivation, u.nick
	from study s, user_table u, member m
	where u.id=#{ id } and m.id=u.id and m.s_num=s.s_num;
  </select>
  
  <select id="selectAppliedStudies" resultMap="appliedStudyResult" parameterType="String">
		select s.s_num, study_name, loc, category, s.img, recruitment, s.input_date, s.deactivation, u.nick
		from user_table u, study s, join j
		where u.id=#{ id } and j.id = u.id and j.s_num = s.s_num;
  </select>
  
  
  <insert id="insertLeaveAlarm" parameterType="kr.co.studystory.vo.LeaveAlarmVO">
   insert into alarm(leaderId, reason, category, subject, content)
   values (#{leaderId}, #{reason}, #{category}, #{subject}, #{content})
  </insert>
  
  <delete id="deleteMember" parameterType="kr.co.studystory.vo.LeaveStudyVO">
  delete from study
  where id=#{id}
  </delete> 
</mapper>